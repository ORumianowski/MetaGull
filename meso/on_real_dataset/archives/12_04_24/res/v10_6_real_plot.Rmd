---
title: "Model v10_6 - real dataset"
author: "Odin Rumianowski"
date: "2024-03-22"
output: html_document
---

```{r setup, echo=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
```


```{r}
library(tidyverse)
library(ggplot2)
library(MCMCvis)
library(knitr)
library(patchwork)
```


The results of the v10_6 model analysis of real dataset with the following computational parameters:

ni <- 50000; nb <- 15000; nc <- 3; nt <- 70; na <- 4000

## En résumé

...




```{r}
#load(file = "out1_integrated_v10_4.Rda")
load(file = "out1_integrated_v10_6_real.Rda")
```

### Apparent survival probability

The values found by Péron are represented by the red dotted line

phi1 = 0.213 - First year

phiA = 0.860 - Subadult and adult

```{r}
PR_unif_01 <- runif(1E8, 0, 1)
```


```{r}
gvals = c(0.213, 0.860)

MCMCtrace(out1, params = c("phi"),
          Rhat = T,
          priors = PR_unif_01,
          gvals = gvals,
          ind = T, pdf = F,
          post_zm = F)

```

### Productivity

D'après Péron:

rhoLR = 1.732 - La Ronze

rhoSAT = 0.605 - Satellite colonies

```{r}

PR <- runif(1E8, 0.1, 3)

gvals = c(1.732, 0.605)

MCMCtrace(out1, params = c("rho"),
          Rhat = TRUE,
          priors = PR,
          gvals = gvals,
          ind = TRUE, pdf = FALSE,
          post_zm = F)


```

### Recruitment probability
D'après Péron: 

kappaLR = 0.619 - La Ronze

kappaSAT = 0.846 - Satellite colonies



```{r}


gvals = c(0.619, 0.846)

MCMCtrace(out1, params = c("kappa"),
          Rhat = TRUE,
          priors = PR_unif_01,
          gvals = gvals,
          ind = TRUE, pdf = FALSE,
          post_zm = F)


```

### Natal dispersion "eta" from one colony to another - colony dependence 

D'après Péron: 

```{r}
kable(out1$mean$eta_monitored, align = "c")
```

### Breeding dispersion "nu" from one colony to another - colony dependence
 
```{r}
kable(out1$mean$nu_monitored, align = "c")
```




### Traces of eta and nu

```{r} 

MCMCtrace(out1, params = c("eta_monitored"),
          Rhat = TRUE,
          priors = PR_unif_01,
          ind = TRUE, pdf = FALSE,
          post_zm = F)


```


```{r} 

MCMCtrace(out1, params = c("nu_monitored"),
          Rhat = TRUE,
          priors = PR_unif_01,
          ind = TRUE, pdf = FALSE,
          post_zm = F)
```

# Recapture probability
           
In the analysis:

```{r}
p1 = out1$mean$po[6,] %>% 
  as.data.frame() %>%
  mutate(., val = .) %>% 
  ggplot(., aes(x =val)) +
  geom_histogram() +
  labs(title = "La Ronze")


p2 = out1$mean$po[7:9,] %>% 
  as.vector() %>% 
  as.data.frame() %>%
  mutate(., val = .) %>% 
  ggplot(., aes(x =val)) +
  geom_histogram()+
  labs(title = "Les satellites")

p3 = p1 + p2

p3

```



### Numbers of breeders and pre-breeders

```{r}


data_ = t(out1[["mean"]][["B"]])

df <- data.frame(
  Temps = rep(seq_len(nrow(data_)), time = ncol(data_)),
  Population = rep(c("pop1", "pop2", "pop3", "pop4", "pop5"), each = nrow(data_)),
  Valeur = as.vector(data_))

p3 = ggplot(df, aes(x = Temps, y = Valeur, color = Population)) +
  geom_line() +
  labs(title = "Breeders - d'après l'analyse",
       x = "Temps",
       y = "Nombre d'individus")

data_ = t(out1[["mean"]][["N"]])

df <- data.frame(
  Temps = rep(seq_len(nrow(data_)), time = ncol(data_)),
  Population = rep(c("pop1", "pop2", "pop3", "pop4", "pop5"), each = nrow(data_)),
  Valeur = as.vector(data_))

p4 = ggplot(df, aes(x = Temps, y = Valeur, color = Population)) +
  geom_line() +
  labs(title = "Prebreeders - d'après l'analyse",
       x = "Temps",
       y = "Nombre d'individus") +
  theme_minimal()



p3
p4
```
